(self["webpackChunkcastmonkeys"]=self["webpackChunkcastmonkeys"]||[]).push([[817],{45817:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>W});var n=a(83673),i=a(62323),r=a(98880);const o={class:"text-white"},s={key:"viewStream",class:" flex flex",style:{display:"grid","grid-gap":"1rem","grid-template-columns":"repeat(auto-fit, minmax(400px, 1fr))",height:"70vh","align-items":"center","justify-content":"center"}},c={key:"activeStream",class:" flex flex",style:{display:"grid","grid-gap":"1rem","grid-template-columns":"repeat(auto-fit, minmax(400px, 1fr))",height:"70vh","align-items":"center","justify-content":"center"}};function l(e,t,a,l,d,m){const h=(0,n.up)("q-spinner-puff"),u=(0,n.up)("q-inner-loading"),p=(0,n.up)("mediacaster"),g=(0,n.up)("activeStream"),f=(0,n.up)("q-scroll-area"),v=(0,n.up)("q-btn"),S=(0,n.up)("controls"),y=(0,n.up)("q-fab"),k=(0,n.up)("q-page-sticky"),w=(0,n.up)("lockStream"),_=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(_,{class:"bg-black flex flex-center",style:{height:"100%",width:"100%"}},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{showing:d.loadState,dark:""},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{size:"150px",color:"orange"}),(0,n.Wm)("span",o,(0,i.zw)(d.property.status),1)])),_:1},8,["showing"]),(0,n.Wm)(f,{class:"q-pa-sm scroller fit",style:{height:"100%"},"thumb-style":e.thumbStyle,ref:"conferenceScroller"},{default:(0,n.w5)((()=>[(0,n.Wm)(r.W3,{appear:"","enter-active-class":"animated slideInLeft","leave-active-class":"animated slideOutLeft"},{default:(0,n.w5)((()=>[e.controls.activeStream?((0,n.wg)(),(0,n.j4)("div",c,[(0,n.Wm)(g,{mediacasters:m.mcs,activeSpeaker:m.activeSpeaker,localStream:m.localStream},null,8,["mediacasters","activeSpeaker","localStream"])])):((0,n.wg)(),(0,n.j4)("div",s,[((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(m.mcs,((e,t)=>((0,n.wg)(),(0,n.j4)(p,{key:t,mediacaster:e,mcsLength:m.mcs.length},null,8,["mediacaster","mcsLength"])))),128))]))])),_:1})])),_:1},8,["thumb-style"]),(0,n.Wm)(v,{label:"test",onClick:m.disconnect,color:"orange"},null,8,["onClick"]),(0,n.Wm)(k,{position:"bottom-right",offset:[13,18]},{default:(0,n.w5)((()=>[(0,n.Wm)(y,{modelValue:d.fab2,"onUpdate:modelValue":t[1]||(t[1]=e=>d.fab2=e),flat:"",square:"","vertical-actions-align":"right",color:"white",dark:"",icon:"keyboard_arrow_left",direction:"left"},{default:(0,n.w5)((()=>[(0,n.Wm)(S,{disconnect:m.disconnect,toggleScreenDisplay:m.toggleScreenDisplay},null,8,["disconnect","toggleScreenDisplay"])])),_:1},8,["modelValue"])])),_:1}),m.isModerator?((0,n.wg)(),(0,n.j4)(k,{key:0,position:"bottom-left",offset:[10,18]},{default:(0,n.w5)((()=>[(0,n.Wm)(y,{modelValue:d.moderator,"onUpdate:modelValue":t[2]||(t[2]=e=>d.moderator=e),flat:"",square:"","vertical-actions-align":"up",color:"deep-orange",dark:"",icon:"admin_panel_settings",direction:"up"},{default:(0,n.w5)((()=>[(0,n.Wm)(v,{dense:"",flat:"",icon:"cast",color:e.controls.activeStream?"white":"deep-orange",onClick:m.setActiveStream,disable:d.moderatorControl.loadState},null,8,["color","onClick","disable"]),e.controls.activeStream?((0,n.wg)(),(0,n.j4)(w,{key:0,setLockStream:m.setLockStream,lockStream:d.lockStream},null,8,["setLockStream","lockStream"])):(0,n.ry)("",!0)])),_:1},8,["modelValue"])])),_:1})):(0,n.ry)("",!0)])),_:1})}var d=a(90515),m=a.n(d),h=(a(65363),a(55250)),u=a(72835),p=a(91368);const g={computed:m()({},(0,h.Se)(["controls","engine"])),methods:m()({},(0,h.nv)(["_auth","_pushConference"])),mounted(){this.$socket.on("disconnectPeer",(async e=>{this.engine.removePeer(e.peer),this.mediacasters=this.mediacasters.filter((t=>t.user._id!==e.peer))})),this.$socket.on("sync-controls",(e=>{var t;if(e.peer!==(null===(t=this.auth)||void 0===t?void 0:t._id)){var a;let t=null===(a=this.engine)||void 0===a?void 0:a.mediacasters.find((t=>t.user._id===e.peer));t&&Object.keys(e.controls).forEach((a=>{let n=a.replace("-","");t.controls[n]=e.controls[a]}))}})),this.$socket.on("updatePeerData",(async e=>{var t;null!==(t=this.engine)&&void 0!==t&&t.loaded&&this.EngineState>=5&&e.conference===this.engine.conference._id&&await this.engine.updatePeer()})),this.$socket.on("control-activeStream",(async e=>{var t;null!==(t=this.engine)&&void 0!==t&&t.loaded&&this.EngineState>=5&&(this.controls.activeStream=e.activeStream)})),this.$socket.on("update-activeStream",(async e=>{var t;null!==(t=this.engine)&&void 0!==t&&t.loaded&&this.EngineState>=5&&await this.engine.setActiveSpeaker(e.activeStream)}))}},f={mixins:[p.Z,g],watch:{EngineState(e){e>=5&&(this.display.footer.open=!0,this.display.footer.display=["localStream"],this.display.footer.data=this.property.localStream,this.display.footer.streams=this.property.myStream)},mcs:{handler(e){e.length>=1?(this.display.leftDrawer.mini=!0,this.loadState=!1):this.loadState=!0,e.length>=2&&!this.controls.activeStream&&(this.display.rightDrawer.open=!1)},deep:!0}},computed:m()(m()({},(0,h.Se)(["display","auth","controls","engine","conference"])),{},{mcs(){var e;return null!==(e=this.engine)&&void 0!==e&&e.mediacasters?this.engine.mediacasters:[]},isModerator(){var e,t;return!(null===(e=this.conference)||void 0===e||null===(t=e._moderator)||void 0===t||!t._id)&&this.conference._moderator._id==this.auth._id},EngineState(){return this.property.state},activeSpeaker(){return this.engine.onWatch.activeSpeaker},localStream(){return this.engine.onWatch.localStream}}),data(){return{loadState:!0,moderatorControl:{loadState:!1},lockStream:!1,disconnecting:!1,moderator:!1,fab2:!0,false:!0,property:{state:0,status:"connecting..."},peers:[],mediacasters:[]}},methods:m()(m()({},(0,h.nv)(["_conference","_resetConference","_engine"])),{},{reset(){window.location.href=`#/community/${this.$route.params.community}`},toggleScreenDisplay(){this.engine.getLocalScreen()},async setLockStream(e){let t;t=e?e._id:e,this.lockStream=e,await this.$cm.post(`stream/${this.$route.params.conference}/lockstream`,{peer:t})},async setActiveStream(){this.moderatorControl.loadState=!0,await this.engine.setActiveStream(!this.controls.activeStream),this.moderatorControl.loadState=!1},leaveConference(){this.$router.replace(`/community/${this.$route.params.community}`)},async getConference(){this.$cm.get(`stream/${this.$route.params.conference}`).then((async e=>{this._conference(e.data),this._engine(new u.Z(e.data,this.auth,this.mediacasters,this.$router)),this.controls.activeStream=e.data._state.options.activeStream,this.property=this.engine.onWatch,await this.engine.connect(this.controls),this.$socket.emit("join-conference",{conference:this.$route.params.conference})})).catch((e=>{this.$router.replace(`/community/${this.$route.params.community}`)}))},disconnect(){var e,t,a,n;this.disconnecting||(this.disconnecting=!0,this.$socket.emit("disconnect-conference",{conference:this.$route.params.conference}),this.$cm.post(`stream/${this.$route.params.conference}/disconnect`,{send:null===(e=this.property)||void 0===e||null===(t=e.sendTransport)||void 0===t?void 0:t._id,recv:null===(a=this.property)||void 0===a||null===(n=a.recvTransport)||void 0===n?void 0:n._id}).then((e=>{this.disconnecting=!1,this.engine.closeLocalProducer(),delete this.engine,this._resetConference(),this.$router.replace(`/community/${this.$route.params.community}`)})).catch((e=>{delete this.engine,this.disconnecting=!1,this._resetConference(),this.$router.replace(`/community/${this.$route.params.community}`)})))}}),created(){this.display.navbar.mini=!1,this.display.footer.open=!1,this.getConference(),document.addEventListener("beforeunload",this.disconnect)},beforeRouteLeave(e,t,a){this.disconnect(),a()}};var v=a(24379),S=a(66941),y=a(8430),k=a(47704),w=a(2165),_=a(21007),$=a(86544),b=a(7518),C=a.n(b);f.render=l;const W=f;C()(f,"components",{QPage:v.Z,QInnerLoading:S.Z,QSpinnerPuff:y.Z,QScrollArea:k.Z,QBtn:w.Z,QPageSticky:_.Z,QFab:$.Z})}}]);